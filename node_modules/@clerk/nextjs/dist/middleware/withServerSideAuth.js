"use strict";
exports.__esModule = true;
exports.withServerSideAuth = void 0;
var tslib_1 = require("tslib");
var utils_1 = require("./utils");
var EMPTY_GSSP_RESPONSE = { props: {} };
var withServerSideAuth = function (cbOrOptions, options) {
    var cb = typeof cbOrOptions === 'function' ? cbOrOptions : undefined;
    var opts = (options ? options : typeof cbOrOptions !== 'function' ? cbOrOptions : {}) || {};
    return function (ctx) { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
        var authData, contextWithAuth, callbackResult;
        return tslib_1.__generator(this, function (_a) {
            switch (_a.label) {
                case 0: return [4 /*yield*/, (0, utils_1.getAuthData)(ctx, opts)];
                case 1:
                    authData = _a.sent();
                    if (!authData) {
                        return [2 /*return*/, EMPTY_GSSP_RESPONSE];
                    }
                    contextWithAuth = (0, utils_1.injectAuthIntoRequest)(ctx, authData);
                    return [4 /*yield*/, (cb === null || cb === void 0 ? void 0 : cb(contextWithAuth))];
                case 2:
                    callbackResult = (_a.sent()) || {};
                    return [2 /*return*/, (0, utils_1.injectSSRStateIntoProps)(callbackResult, (0, utils_1.sanitizeAuthData)(authData))];
            }
        });
    }); };
};
exports.withServerSideAuth = withServerSideAuth;
//# sourceMappingURL=withServerSideAuth.js.map