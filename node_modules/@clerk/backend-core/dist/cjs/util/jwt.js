"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.checkClaims = exports.isExpired = void 0;
const types_1 = require("../types");
const errors_1 = require("./errors");
const DEFAULT_ADDITIONAL_CLOCK_SKEW = 0;
function isExpired(payload, additionalClockSkew = DEFAULT_ADDITIONAL_CLOCK_SKEW) {
    const now = Date.now() / 1000;
    if (payload.exp && now > payload.exp + additionalClockSkew) {
        throw new errors_1.TokenVerificationError(types_1.TokenVerificationErrorReason.Expired);
    }
    if (payload.nbf && now < payload.nbf - additionalClockSkew) {
        throw new errors_1.TokenVerificationError(types_1.TokenVerificationErrorReason.NotActiveYet);
    }
}
exports.isExpired = isExpired;
function checkClaims(claims, authorizedParties) {
    if (!claims.iss || !claims.iss.startsWith('https://clerk')) {
        throw new errors_1.TokenVerificationError(types_1.TokenVerificationErrorReason.InvalidIssuer);
    }
    if (claims.azp && authorizedParties && authorizedParties.length > 0) {
        if (!authorizedParties.includes(claims.azp)) {
            throw new errors_1.TokenVerificationError(types_1.TokenVerificationErrorReason.UnauthorizedParty);
        }
    }
}
exports.checkClaims = checkClaims;
